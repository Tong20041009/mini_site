<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>七夕 · 跳动的爱心</title>
<style>
  html,body{height:100%;margin:0;background:#000;overflow:hidden}
  canvas{display:block}
  /* 可选：长按/选中文字禁用 */
  *{user-select:none;-webkit-user-select:none}
</style>
</head>
<body>
<canvas id="cv" aria-label="七夕·跳动的爱心"></canvas>
<script>
/* ====== 配置（想改风格就改这里） ====== */
const MESSAGE   = "姐姐 七夕快乐";   // 设为 "" 可隐藏文字
const COLOR     = "#ff3ba7";       // 爱心主色
const COLOR_2   = "#ffd1e6";       // 高光点色
const BG        = "#000";          // 背景
const GLOW      = 8;               // 发光强度(0-12)

/* ====== 画布与高清屏适配 ====== */
const cvs = document.getElementById('cv');
const ctx = cvs.getContext('2d', {alpha:false});
function resize(){
  const dpr = Math.max(1, Math.min(2.5, devicePixelRatio||1));
  const w = innerWidth, h = innerHeight;
  cvs.style.width = w+"px"; cvs.style.height = h+"px";
  cvs.width = Math.floor(w*dpr); cvs.height = Math.floor(h*dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize(); addEventListener('resize', ()=>{ resize(); build(); });

/* ====== 心形方程（y 取反，朝上） ====== */
function heart(t, scale){
  let x = 16 * Math.sin(t)**3;
  let y = -(13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
  x *= scale; y *= scale;
  return [x + innerWidth/2, y + innerHeight/2];
}

/* 工具函数 */
function scatter(x,y,beta){
  const cx=innerWidth/2, cy=innerHeight/2;
  const rx = -beta * Math.log(Math.random()+1e-6);
  const ry = -beta * Math.log(Math.random()+1e-6);
  return [x - rx*(x-cx), y - ry*(y-cy)];
}
function pushOut(x,y,ratio){
  const cx=innerWidth/2, cy=innerHeight/2;
  const dx=x-cx, dy=y-cy;
  const force = 1 / (Math.pow(dx*dx+dy*dy, 0.52)+1e-6);
  return [x - ratio*force*dx + (Math.random()*2-1),
          y - ratio*force*dy + (Math.random()*2-1)];
}

/* ====== 预生成粒子（按屏幕大小自适应，流畅不卡） ====== */
let basePts=[], edgePts=[], centerPts=[], glowPts=[];
function build(){
  basePts.length = edgePts.length = centerPts.length = glowPts.length = 0;
  const shortSide = Math.min(innerWidth, innerHeight);
  const scale = shortSide/40;
  const d = shortSide < 740 ? 1.0 : 1.25; // 平板更密

  const N_base   = Math.floor(1200*d);
  const N_edge   = Math.floor(1600*d);
  const N_center = Math.floor(1600*d);
  const N_glow   = Math.floor(1300*d);

  for(let i=0;i<N_base;i++){
    const t = Math.random()*Math.PI*2;
    basePts.push(heart(t, scale*1.08));
  }
  for(const p of basePts){
    if(edgePts.length>=N_edge) break;
    for(let k=0;k<2;k++) edgePts.push(scatter(p[0],p[1],0.06));
  }
  for(let i=0;i<N_center;i++){
    const p = basePts[(Math.random()*basePts.length)|0];
    centerPts.push(scatter(p[0],p[1],0.17));
  }
  // 外圈柔光点
  for(let i=0;i<N_glow;i++){
    const t = Math.random()*Math.PI*2;
    let [x,y] = heart(t, scale*1.15);
    const cx=innerWidth/2, cy=innerHeight/2, dx=x-cx, dy=y-cy;
    const force = 1 / (Math.pow(dx*dx+dy*dy, 0.6)+1e-6);
    const r = 8 + Math.random()*8;
    x -= r*force*dx + (Math.random()*22-11);
    y -= r*force*dy + (Math.random()*22-11);
    glowPts.push([x,y]);
  }
}
build();

/* ====== 动画循环 ====== */
let frame=0, showMsg = true;
function drawText(){
  if(!MESSAGE || !showMsg) return;
  const cx=innerWidth/2, cy=innerHeight/2;
  const fontSize = Math.max(22, Math.min(42, innerWidth/12));
  const g = ctx.createLinearGradient(cx-fontSize*2, cy-fontSize, cx+fontSize*2, cy+fontSize);
  g.addColorStop(0, COLOR_2); g.addColorStop(1, COLOR);
  ctx.save();
  ctx.font = `600 ${fontSize}px "PingFang SC", "SF Pro Display", system-ui`;
  ctx.textAlign = "center"; ctx.textBaseline = "middle";
  ctx.shadowColor = COLOR; ctx.shadowBlur = GLOW;
  ctx.fillStyle = g;
  const a = 0.75 + 0.25*Math.sin(frame/30);
  ctx.globalAlpha = a;
  ctx.fillText(MESSAGE, cx, cy);
  ctx.restore();
}

function loop(){
  frame++;
  // 柔擦背景，留拖影
  ctx.globalAlpha = 0.22;
  ctx.fillStyle = BG;
  ctx.fillRect(0,0,innerWidth,innerHeight);

  // 绘制设置
  ctx.globalAlpha = 1;
  ctx.globalCompositeOperation = 'lighter';
  ctx.shadowColor = COLOR; ctx.shadowBlur = GLOW;

  const ratio = 7 + Math.sin(frame/12)*9;

  // 画函数
  function draw(list, color){
    ctx.fillStyle = color;
    for(let i=0;i<list.length;i++){
      let [x,y] = list[i];
      [x,y] = pushOut(x,y, ratio);
      const s = Math.random()<0.5 ? 1 : 2;
      ctx.fillRect(x,y,s,s);
    }
  }
  draw(glowPts, COLOR);      // 外圈柔光
  draw(basePts, COLOR);      // 边界
  draw(edgePts, COLOR);      // 扩散
  draw(centerPts, COLOR_2);  // 高光点

  drawText();                // 中心祝福文字（可在顶部关闭）

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* 轻触切换是否显示文字 */
addEventListener('click', ()=>{ showMsg = !showMsg; }, {passive:true});
</script>
</body>
</html>